# 自习室座位预约系统测试指南

## 🔧 问题修复总结

### ✅ 已修复的问题

1. **登录密码验证问题** - 修复了注册时 BCrypt 加密但登录时直接比较明文的问题
2. **用户创建失败问题** - 修复了 role 字段值'USER'与数据库枚举'STUDENT','ADMIN'不匹配的问题
3. **管理员 403 权限错误** - 添加了 JWT 过滤器到 Spring Security 配置，修复权限验证
4. **报表统计问题** - 修复了统计 API 调用，添加了真实的后端接口调用
5. **公告管理功能** - 完整实现了公告管理的前后端功能

## 🚀 服务启动

### 后端服务 (端口:8082)

```bash
cd seat-reservation-backend
mvn spring-boot:run
```

### 前端服务 (端口:3000)

```bash
cd seat-reservation-frontend
npm run dev
```

## 🧪 测试步骤

### 1. 测试登录功能

**管理员账号**：

- 用户名：`admin`
- 密码：`admin123`

**学生账号**：

- 用户名：`student001`
- 密码：`123456`

### 2. 测试管理员功能 (需用管理员账号登录)

访问 `http://localhost:3000/admin`

#### ✅ 数据看板

- 统计卡片显示实时数据
- 预约趋势图表
- 座位类型分布
- 使用率热图

#### ✅ 座位管理

- 座位列表查询和筛选
- 添加/编辑/删除座位
- 座位状态管理

#### ✅ 预约管理

- 预约记录查询
- 预约状态筛选
- 日期范围筛选

#### ✅ 用户管理

- 用户列表查询 (不再出现 403 错误)
- 创建新用户 (修复了 role 字段问题)
- 编辑用户信息
- 用户状态管理
- 密码重置

#### ✅ 公告管理 (新增功能)

- 公告列表管理
- 创建/编辑公告
- 发布/归档公告
- 公告状态管理

#### ✅ 报表统计 (修复完成)

- 预约统计概览
- 座位利用率统计
- 用户活跃度分析
- 详细统计图表

#### ✅ 系统设置

- 基本系统配置
- 开放时间设置
- 预约规则配置

### 3. 测试用户功能

#### 座位预约 (`/seat-map`)

- 查看座位布局图
- 选择座位进行预约
- 查看座位状态

#### 我的预约 (`/reservations`)

- 查看预约历史
- 取消预约
- 预约状态跟踪

#### 个人资料 (`/profile`)

- 查看个人信息
- 修改基本资料

### 4. 测试注册功能

访问 `http://localhost:3000/register`

- 创建新账号
- 验证密码加密正确
- 用新账号登录验证

## 🔍 常见问题排查

### 1. 如果登录仍然失败

```sql
-- 检查数据库中的用户数据
SELECT id, username, real_name, role, status FROM sys_user;

-- 手动更新密码（如果需要）
UPDATE sys_user SET password = '$2a$10$N4VKaCI8m7XwlvGLfGz4aOKBOxk9FLLCXqT5t4v8QHgtsFLLp5x6a' WHERE username = 'admin';
```

### 2. 如果 403 错误仍然存在

- 确认 JWT Token 正确传递
- 检查用户角色是否为'ADMIN'
- 查看浏览器 Network 面板确认请求头

### 3. 如果统计数据不显示

- 检查后端统计服务是否正常运行
- 查看浏览器控制台错误信息
- 确认数据库中有测试数据

## 🎯 测试重点

1. **用户创建** - 验证 role 字段修复
2. **管理员登录** - 验证权限问题修复
3. **统计功能** - 验证 API 调用修复
4. **公告管理** - 验证新功能完整性
5. **跨页面导航** - 确保所有功能正常访问

## 📝 预期结果

- ✅ 所有登录问题解决
- ✅ 管理员页面不再出现 403 错误
- ✅ 用户创建成功，无 role 字段错误
- ✅ 统计数据正常显示
- ✅ 公告管理功能完全可用
- ✅ 所有 CRUD 操作正常工作

如果仍有问题，请提供具体的错误信息以便进一步排查。
